> <del>我7发呼符政哥哥</del>
# 警告
<<哔哩哔哩游戏平台用户协议>>第19条中规定:  
2、未经许可的第三方软件指可用于在游戏中获取优势,但不属于相应本平台游戏一部分的任何文件或程序 ,包括作弊性质的外挂以及相关辅助性质的外挂等(包括但不限于自动升级、自动练级、自动吃药、自动完成任务、加速性质、模拟加点、战斗显血或其他超出游戏设定范围的操作)。如若发现使用作弊性质的外挂以及相关辅助性质的外挂等,我们将对其采取严厉的处罚措施,包括:没收玩家利用第三方软件进行游戏而直接、间接获得之不正当利益;倒扣数值(包括但不限于经验值) ; 撤销交易;扣除违规交易所得;交易功能限制;暂时冻结玩法;永久冻结玩法;强制离线;暂时禁止登录;永久禁止登录;删除档案;承担法律责任。  
由于使用本脚本而导致的包括但不限于上述各项的损失本人概不负责,您下载并使用该脚本即代表您已知晓使用脚本可能带来的风险并愿意承担可能出现的后果,望周知  
---
# 使用说明 Instruction
**本说明对应的是v2.7.x版本,并非全部内容都适用于最新版本**  
显示的宽度必须为1080px,长度必须不小于1920px,无论是模拟器还是真机都可以使用该脚本  
虽然改一行代码就能应用于任意分辨率,但这可能导致识别问题,需要手动修改精度限制  
**请在手机的/sdcard目录下新建一个名为adbtemp的文件夹**  
你的电脑上要有[adb](https://developer.android.google.cn/studio/command-line/adb)  
你得会一点点python,不用很多,因为本脚本的[1.0版本](https://www.bilibili.com/video/av34399081)是用c写的,很多东西就是直接翻译过来的面向过程的代码  
使用了以下库:  
time os functools numpy cv2  
新增:win32con win32ui win32gui  

本脚本就一个源文件,直接运行或编辑  
代码最后几行就是主程序  
+ 在点击列表中第一个关卡就能进入选择助战界面的界面启动main函数来清空体力条,若传入一个int就会额外吃相应数量的金苹果  
+ 在进入战斗后尚未选卡的界面启动oneBattle函数来完成这一战斗,若传入一个有三个int的list就会在各stage优先攻击左起自1开始编号的敌人  

每一回合的战斗都会输出相应信息,包括:  
1. 当前回合数  
2. 当前stage数  
3. 这一stage已经进行的回合数  
4. 各技能是否冷却完毕  
5. 各宝具是否充能完毕  
6. 各指令卡颜色  
7. 选择的指令卡序列  

我的qq 979449732,email huguangjing0411@geektip.cc,fgouid 100,103,306,269  
有任何问题或bug反馈请联系,觉得有帮助请为我star  
请向可怜的非酋投喂<del>圣晶石</del>彩苹果  
## 你需要修改slnPath,adbPath和dpx  
slnPath是本解决方案的绝对位置,方便你把代码和其他资源分开放  
adbpath中要根据你的设备连接方式进行修改  
dpx为左侧的蓝边宽度(如果不是16:9屏幕),例如2160*1080就dpx=(2160-1920)/2=120  
## 你可以修改skillInfo数组
skillinfo列表记录了技能的信息  
skillinfo[编队中的第i个从者] [的第j个技能]=[的最小使用stage数,在该stage的最小使用回合数,指向的目标(没有目标置0)]  
也就是说,若不使用技能就skillInfo[i] [j] [0]=4  
这样的安排足以应付日常周回的各种情况,比如三面boss充能五格,就把保命技能=[3,6,0]<font color="red">此处相较之前版本有重要更改</font>  
## 你可以修改houguInfo数组
houguinfo列表记录了宝具的信息  
houguinfo[编队中的第i个从者]=[的宝具的最小使用stage数,在该stage的最小使用回合数,是否优先使用(优先置1)]  
## 助战 Friends
你可以在main函数中chooseFriend的注释挪到他的下一行来启用助战选取功能  
你需要事先将你期望的各种助战的样子截图为png放在asserts/friend下,参照asserts/friend/unused中的文件  
**被截图范围都应该可以点击来选中该好友**  
如果你用的是模拟器,请使用本程序的screenshot函数来截图而不要用模拟器自带的截图,更不要用prtSc键来截图,这可能会导致识别错误  
如果你用的是手机,screenshot函数也可以大大方便你的操作  
助战截图的名称中若有下划线'_',且下划线之前的部分为km,ml,cba,则代表好友就挂的是孔明,梅林,十八岁美少女,这会影响助战技能的使用,参见choosefriend函数具体实现<font color="red">此处相较之前版本有重要更改</font>  
# 注意 Caution
出于效率考虑,宝具与技能是否可以使用会在同一次识别进行,也就是说,你**不应该使用会使np减少的技能**  
若战斗失败会自动撤退并留下记录然后继续下一把(若战斗失败就发出噪音把你吵醒起来改代码?倒也不是不能做到啦)  
有些时候对从者头像的识别会有错误,*虽然在不断以各种方式优化,但这个问题至今未解决,需要更合理的框选匹配范围* ,所以**如果你打算睡觉去,就别用带有指向的技能,也不要用后排的技能**,否则一觉起来发现打第二把的时候就卡住了...  
你的帐号里必须有一个及以上的金苹果,否则体力用完了也检测不出来,可能引发未知错误,也可能不会.由于我目前没办法把金苹果全部吃光所以不知道如果没有金苹果时会弹出什么样的窗口也截不到图所以这个问题在圣诞活动倒数几天前暂时无法修复...<font color="red">此处相较之前版本有重要更改</font>  
# Q&A&杂谈  
这里之后会写一点内容,把上面跟核心内容无关的部分写到这里来  
# 版本记录 Version Logs
## 2020/01/08 v2.8.2
截图从v2.8.1的qt改回win32api了...  
修改了一些判定的模板图片  
正在尝试用多帧来进行一次判定来提高可靠性,比如houguinfo  
## 2020/01/08 v2.8.0
稳定性优化  
肝!
## 2020/01/07 v2.8.0beta  
紧急更新  
本次更新内容可靠性未经充分验证,请谨慎下载使用  
使用了win32api代替之前的adb进行截图,单次截图时间从1s级别减低到了10ms级别  
这段代码是不带裁剪和缩放的,所以**需要模拟器在正好1920*1080的显示器上全屏显示,真机的话要用投屏软件**  
由于之前的代码有一些地方是依赖截图的耗时来进行延迟的,这一延迟消失后可能引发各种各样的问题,所以我正在一点一点地在必要的地方加上显式延迟,但是仍然会有疏漏,之后发现一个解决一个,慢慢改  
## 2020/01/03 v2.7.0
打版本日志的时候突然发现已经2020年了...期末考好累...  
圣诞活动7号晚上开始,但是期末考9号才结束...  
所以复习放一边去,先把脚本给写了  
重大bug修复,带指向的技能现在会正确地施放了(尽管识别错误的问题仍然存在)  
微调了部分按键坐标,**现在你可以吃银苹果和铜苹果了**  
小优化,切换目标后加了冗余点击以关闭在点击已选中目标时产生的敌人详情对话框  
增加了所谓"快速换装(setSkillInfo)"函数,**先把配置写好,然后活动一开就上号挂机岂不美哉**!  
flag:我圣诞要吃光苹果,当前金苹果当量287  
## 2019/11/26 v2.6.0
蓝叠模拟器更到最新版就不会闪退了  
chooseFriend函数还是挺重要的,要用来选取特定从者  
明天(2019年11月27日星期三)上午8:30通关主线第8话(前篇)后开启炎舞击退战,
增加了一小段代码用于otk,现在直接运行脚本就是单次执行该脚本  
这段代码专用于"三美少女队",如果你没有bba/cba中的任何一个,或嫖不到cba,告辞.  
需要极地迦勒底制服  
**本次活动特攻是"特殊的魔放",会稀释其他的倍率,可恶!**  
## 2019/11/10 v2.5.2
版本更新后蓝叠模拟器闪退,在物理机上的兼容性未发现显著问题.  
版本更新后可以对助战礼装进行筛选,chooseFriend函数变得不再重要,已在主程序中禁用.